---
export const prerender = true;
import ChapterLayout from '../layouts/ChapterLayout.astro';
import { chapters } from '../data/chapters';
import FadeInBlock from '../components/scroll/FadeInBlock';
import AccentBar from '../components/ui/AccentBar';
import ConceptCard from '../components/ui/ConceptCard';
import Divider from '../components/ui/Divider';
import TerminalPlayground from '../components/widgets/ch7/TerminalPlayground';
import SkillBuilder from '../components/widgets/ch7/SkillBuilder';
import RefactorRace from '../components/widgets/ch7/RefactorRace';

const chapter = chapters[6];
---

<ChapterLayout chapter={chapter}>

  <!-- ═══ HERO ═══ -->
  <section class="min-h-[80vh] flex flex-col items-center justify-end px-6 pb-20 relative overflow-hidden">
    <!-- Giant background number -->
    <div class="chapter-number" style={`color: ${chapter.accent};`}>7</div>

    <div class="max-w-[680px] mx-auto text-center relative z-10">
      <FadeInBlock client:visible>
        <p class="text-[13px] italic text-subtle/60 mb-5" style="font-family: var(--font-body);">
          Chapter Seven
        </p>
      </FadeInBlock>

      <FadeInBlock client:visible delay={0.15}>
        <h1
          class="mb-8 leading-[1.08]"
          style={`font-family: var(--font-heading); color: ${chapter.accent}; font-size: clamp(2.8rem, 7vw, 4.5rem); font-weight: 800; letter-spacing: -0.03em;`}
        >
          Mastering<br />Claude Code
        </h1>
      </FadeInBlock>

      <FadeInBlock client:visible delay={0.3}>
        <p class="text-lg md:text-xl italic text-deep/40 leading-relaxed max-w-sm mx-auto" style="font-family: var(--font-body);">
          Your AI pair programmer, from first<br />command to custom Skills.
        </p>
      </FadeInBlock>
    </div>

    <!-- Scroll cue -->
    <div class="absolute bottom-6 left-1/2 -translate-x-1/2 opacity-20 animate-pulse">
      <div class="w-px h-10 bg-deep/40"></div>
    </div>
  </section>

  <!-- ═══ STORY OPENER — with drop cap ═══ -->
  <section class="max-w-[680px] mx-auto px-6 md:px-10 pt-24 pb-16">
    <FadeInBlock client:visible>
      <p class="drop-cap text-lg leading-[1.85] mb-8">
        There's a moment every coder remembers. You open a terminal, type a natural-language request, and watch an AI read your files, understand your architecture, write code across multiple files, run it, hit an error, fix the error, and run it again — all without you touching a single line. That's Claude Code.
      </p>
    </FadeInBlock>

    <FadeInBlock client:visible delay={0.1}>
      <p class="text-lg leading-[1.85] mb-8">
        It's not autocomplete. It's not a chatbot that writes snippets. Claude Code is an <em>agentic</em> coding tool — a command-line partner that can see your entire project, make changes across files, execute shell commands, and iterate on its own mistakes. It doesn't just suggest code. It <strong>ships</strong> code.
      </p>
    </FadeInBlock>

    <FadeInBlock client:visible delay={0.2}>
      <p class="text-lg leading-[1.85]">
        But here's the thing nobody tells you: the tool is only as good as the human steering it. Claude Code can write a thousand lines of perfect code in seconds — or a thousand lines of plausible-looking garbage. The difference is you.
      </p>
    </FadeInBlock>
  </section>

  <Divider accent={chapter.accent} client:load />

  <!-- ═══ HOW CLAUDE CODE THINKS ═══ -->
  <section class="max-w-[680px] mx-auto px-6 md:px-10 py-16">
    <FadeInBlock client:visible>
      <AccentBar color={chapter.accent} className="w-16 mb-10" client:visible />
      <h2 class="mb-8" style="font-family: var(--font-heading); letter-spacing: -0.02em;">
        How Claude Code Thinks
      </h2>
    </FadeInBlock>

    <FadeInBlock client:visible delay={0.1}>
      <p class="text-lg leading-[1.85] mb-10">
        When you give Claude Code a task, it doesn't just start typing. It runs a loop, the same one that powers every AI agent:
      </p>
    </FadeInBlock>

    <!-- Agent loop visualization -->
    <FadeInBlock client:visible delay={0.15}>
      <div style={`position: relative; padding-left: 2.5rem; margin-bottom: 3rem;`}>
        <div style={`position: absolute; left: 7px; top: 8px; bottom: 8px; width: 1px; background: linear-gradient(to bottom, ${chapter.accent}, ${chapter.accent}20);`}></div>
        {[
          { word: 'Read.', desc: 'Scan the codebase — files, imports, tests, configs. Understand what exists.' },
          { word: 'Plan.', desc: 'Decide what to change, in which files, in what order.' },
          { word: 'Write.', desc: 'Make the edits. Create files. Modify code.' },
          { word: 'Run.', desc: 'Execute commands — build, test, lint. See what happens.' },
          { word: 'Fix.', desc: 'If something broke, read the error, adjust, and try again.' },
        ].map((step, i) => (
          <div style={`position: relative; padding-bottom: ${i < 4 ? '1.75rem' : '0'};`}>
            <div style={`position: absolute; left: -2.5rem; top: 6px; width: 15px; height: 15px; border-radius: 50%; border: 2px solid ${chapter.accent}; background: var(--color-cream);`}></div>
            <p style="margin: 0; font-size: 1rem; line-height: 1.5;">
              <strong style={`color: ${chapter.accent}; font-family: var(--font-heading); font-weight: 700;`}>{step.word}</strong>
              <span style="opacity: 0.7;"> {step.desc}</span>
            </p>
          </div>
        ))}
      </div>
    </FadeInBlock>

    <FadeInBlock client:visible delay={0.25}>
      <p class="text-lg leading-[1.85] mb-10">
        This read-plan-write-run-fix loop is what makes Claude Code different from a simple code generator. It doesn't hand you a snippet and walk away. It <em>stays in the loop</em> — iterating until the code actually works.
      </p>
    </FadeInBlock>

    <FadeInBlock client:visible delay={0.3}>
      <p class="text-lg leading-[1.85]">
        Think of it like pair programming. You describe what you want. Claude Code writes it. The tests fail. Claude Code reads the error, adjusts, re-runs. This cycle might happen three, five, ten times — all in seconds.
      </p>
    </FadeInBlock>
  </section>

  <!-- ═══ WIDGET: TERMINAL PLAYGROUND ═══ -->
  <section class="max-w-[900px] mx-auto px-6 md:px-10 py-8">
    <FadeInBlock client:visible>
      <TerminalPlayground client:visible />
    </FadeInBlock>
  </section>

  <Divider accent={chapter.accent} client:load />

  <!-- ═══ THE CLAUDE.MD FILE ═══ -->
  <section class="max-w-[680px] mx-auto px-6 md:px-10 py-16">
    <FadeInBlock client:visible>
      <AccentBar color={chapter.accent} className="w-16 mb-10" client:visible />
      <h2 class="mb-8" style="font-family: var(--font-heading);">
        The CLAUDE.md File
      </h2>
    </FadeInBlock>

    <FadeInBlock client:visible delay={0.1}>
      <p class="text-lg leading-[1.85] mb-10">
        Here's a secret that separates beginners from power users: <strong>you can give Claude Code permanent instructions.</strong>
      </p>
    </FadeInBlock>

    <FadeInBlock client:visible delay={0.15}>
      <p class="text-lg leading-[1.85] mb-10">
        Drop a file called <code>CLAUDE.md</code> in the root of your project, and Claude Code reads it at the start of every session. It's like a system prompt, but for your entire codebase.
      </p>
    </FadeInBlock>

    <FadeInBlock client:visible delay={0.2}>
      <div class="prompt-block mb-10" style={`--accent: ${chapter.accent};`}>
        <div style={`position:absolute;top:-1px;left:2rem;right:2rem;height:2px;border-radius:1px;background:${chapter.accent};`}></div>
        <span class="prompt-block-label" style={`color: ${chapter.accent};`}>CLAUDE.md</span>
        <p class="m-0 leading-relaxed" style="color: var(--color-deep); font-family: var(--font-mono); font-size: 0.85rem;">
          # My Project<br /><br />
          Tech stack: Astro + React + Tailwind<br />
          Always use TypeScript with strict mode.<br />
          Put components in src/components/.<br />
          Write tests for every new function.<br />
          Use Prettier formatting — never change the config.<br /><br />
          ## Style Rules<br />
          - Prefer named exports over default exports<br />
          - Use CSS modules, not inline styles<br />
          - Keep components under 150 lines
        </p>
      </div>
    </FadeInBlock>

    <FadeInBlock client:visible delay={0.25}>
      <p class="text-lg leading-[1.85] mb-10">
        Without a CLAUDE.md, you spend the first few minutes of every session re-explaining your preferences. With one, Claude Code already knows your stack, your conventions, and your boundaries. It's context engineering (Chapter 3) applied to coding.
      </p>
    </FadeInBlock>

    <FadeInBlock client:visible delay={0.3}>
      <div class="insight-box">
        <p style={`font-family: var(--font-heading); font-size: 0.85rem; font-weight: 700; color: ${chapter.accent}; margin: 0 0 0.5rem;`}>Think of CLAUDE.md as your project's constitution.</p>
        <p style="font-size: 1rem; line-height: 1.75; margin: 0;">
          It encodes the decisions you've already made — so the AI can focus on the decisions that are actually new. The more specific your CLAUDE.md, the less you have to repeat yourself.
        </p>
      </div>
    </FadeInBlock>
  </section>

  <Divider accent={chapter.accent} client:load />

  <!-- ═══ BUILDING SKILLS ═══ -->
  <section class="max-w-[680px] mx-auto px-6 md:px-10 py-16">
    <FadeInBlock client:visible>
      <AccentBar color={chapter.accent} className="w-16 mb-10" client:visible />
      <h2 class="mb-8" style="font-family: var(--font-heading);">
        Building Skills
      </h2>
    </FadeInBlock>

    <FadeInBlock client:visible delay={0.1}>
      <p class="text-lg leading-[1.85] mb-10">
        A CLAUDE.md gives Claude Code general knowledge about your project. But what about specific, repeatable tasks? That's where <strong>Skills</strong> come in.
      </p>
    </FadeInBlock>

    <FadeInBlock client:visible delay={0.15}>
      <p class="text-lg leading-[1.85] mb-10">
        A skill is a set of instructions inside your CLAUDE.md that teaches Claude Code how to handle a particular kind of task. Think of it as a recipe: "When someone asks you to create a new React component, here's exactly how to do it."
      </p>
    </FadeInBlock>

    <FadeInBlock client:visible delay={0.2}>
      <div class="pull-quote" style={`border-color: ${chapter.accent};`}>
        Without skills, you explain the same steps every time. With skills, you explain once and the AI remembers forever.
      </div>
    </FadeInBlock>

    <FadeInBlock client:visible delay={0.25}>
      <p class="text-lg leading-[1.85] mb-10">
        A good skill has three parts:
      </p>
    </FadeInBlock>

    <div style="display: flex; flex-direction: column; gap: 2rem; margin-bottom: 3rem;">
      {[
        { letter: 'T', name: 'Trigger', color: '#7B61FF', text: 'When does this skill activate? "When asked to create a component..." or "When fixing a test failure..." Clear triggers prevent the AI from using the wrong recipe.' },
        { letter: 'S', name: 'Steps', color: '#16C79A', text: 'What exactly should it do, in order? Numbered steps work best. Be specific about file locations, naming conventions, and required patterns.' },
        { letter: 'E', name: 'Examples', color: '#F5A623', text: 'Show what a successful result looks like. A before-and-after, an example file structure, or a sample output. Ambiguity dies in the presence of examples.' },
      ].map((block, i) => (
        <FadeInBlock client:visible delay={0.3 + i * 0.08}>
          <div style={`display: flex; gap: 1.5rem; align-items: flex-start;`}>
            <div style={`flex-shrink: 0; width: 40px; height: 40px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-family: var(--font-heading); font-size: 1.1rem; font-weight: 800; color: white; background: ${block.color};`}>
              {block.letter}
            </div>
            <div style="flex: 1;">
              <p style={`font-family: var(--font-heading); font-size: 1.1rem; font-weight: 700; color: ${block.color}; margin: 0 0 0.35rem; line-height: 1.3;`}>
                {block.name}
              </p>
              <p style="font-size: 1rem; line-height: 1.75; color: var(--color-deep); opacity: 0.75; margin: 0;">
                {block.text}
              </p>
            </div>
          </div>
        </FadeInBlock>
      ))}
    </div>
  </section>

  <!-- ═══ WIDGET: SKILL BUILDER ═══ -->
  <section class="max-w-[900px] mx-auto px-6 md:px-10 py-8">
    <FadeInBlock client:visible>
      <SkillBuilder client:visible />
    </FadeInBlock>
  </section>

  <Divider accent={chapter.accent} client:load />

  <!-- ═══ SPECIFY, GENERATE, VERIFY ═══ -->
  <section class="max-w-[680px] mx-auto px-6 md:px-10 py-16">
    <FadeInBlock client:visible>
      <AccentBar color={chapter.accent} className="w-16 mb-10" client:visible />
      <h2 class="mb-8" style="font-family: var(--font-heading);">
        Specify, Generate, Verify
      </h2>
    </FadeInBlock>

    <FadeInBlock client:visible delay={0.1}>
      <p class="text-lg leading-[1.85] mb-10">
        When you work with Claude Code, your job changes. You're no longer the person who writes every line. You're the person who <strong>specifies</strong> what to build, lets the AI <strong>generate</strong> it, and then <strong>verifies</strong> that it's actually right.
      </p>
    </FadeInBlock>

    <FadeInBlock client:visible delay={0.15}>
      <p class="text-lg leading-[1.85] mb-10">
        This loop — specify, generate, verify — is the fundamental workflow:
      </p>
    </FadeInBlock>

    <!-- SGV Loop -->
    <FadeInBlock client:visible delay={0.2}>
      <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-12">
        {[
          { step: '01', title: 'Specify', desc: 'Be precise about what you want. The clearer your request, the less time you spend fixing the output. Include edge cases, file locations, and expected behavior.', color: '#7B61FF' },
          { step: '02', title: 'Generate', desc: 'Let Claude Code do its thing. Watch the agent loop — reading, planning, writing, running, fixing. Resist the urge to interrupt mid-cycle.', color: '#0EA5E9' },
          { step: '03', title: 'Verify', desc: 'This is your most important job. Read the code. Run the tests. Check edge cases. Does it actually do what you asked? Is it code you would sign your name to?', color: '#16C79A' },
        ].map((item) => (
          <div style={`background: ${item.color}06; border: 1px solid ${item.color}18; border-radius: 12px; padding: 1.25rem;`}>
            <div style={`font-family: var(--font-mono); font-size: 0.65rem; font-weight: 700; color: ${item.color}; letter-spacing: 0.1em; margin-bottom: 0.5rem;`}>{item.step}</div>
            <div style={`font-family: var(--font-heading); font-size: 1rem; font-weight: 700; color: ${item.color}; margin-bottom: 0.5rem;`}>{item.title}</div>
            <p style="font-size: 0.85rem; line-height: 1.65; color: var(--color-deep); opacity: 0.7; margin: 0;">
              {item.desc}
            </p>
          </div>
        ))}
      </div>
    </FadeInBlock>

    <FadeInBlock client:visible delay={0.3}>
      <p class="text-lg leading-[1.85] mb-10">
        Most beginners skip step three. They see code appear, it looks reasonable, and they move on. Don't be that person. <strong>Generated code is a first draft.</strong> Your verification is the edit that makes it publishable.
      </p>
    </FadeInBlock>

    <FadeInBlock client:visible delay={0.35}>
      <p class="text-lg leading-[1.85]">
        The irony? The faster the AI generates code, the <em>more important</em> your verification becomes. Speed without judgment is just faster mistakes.
      </p>
    </FadeInBlock>
  </section>

  <Divider accent={chapter.accent} client:load />

  <!-- ═══ THE SKILL PARADOX ═══ -->
  <section class="max-w-[680px] mx-auto px-6 md:px-10 py-16">
    <FadeInBlock client:visible>
      <AccentBar color={chapter.accent} className="w-16 mb-10" client:visible />
      <h2 class="mb-8" style="font-family: var(--font-heading);">
        The Skill Paradox
      </h2>
    </FadeInBlock>

    <FadeInBlock client:visible delay={0.1}>
      <p class="text-lg leading-[1.85] mb-10">
        Here's the uncomfortable truth about AI-assisted coding: <strong>you need to know enough to judge the output, even if you didn't write it yourself.</strong>
      </p>
    </FadeInBlock>

    <FadeInBlock client:visible delay={0.15}>
      <div class="pull-quote" style={`border-color: ${chapter.accent};`}>
        If you can't read the code Claude generates, you can't verify it. If you can't verify it, you're shipping someone else's guesses into production.
      </div>
    </FadeInBlock>

    <FadeInBlock client:visible delay={0.2}>
      <p class="text-lg leading-[1.85] mb-10">
        This creates a paradox: the tool that helps beginners write code also requires enough knowledge to evaluate that code. The way through? Use Claude Code <em>to learn</em>, not just to produce.
      </p>
    </FadeInBlock>

    <FadeInBlock client:visible delay={0.25}>
      <p class="text-lg leading-[1.85] mb-10">
        When Claude Code writes something you don't understand, don't just accept it. Ask: "Explain what this code does and why you chose this approach." Use the AI as a tutor, not just a typist.
      </p>
    </FadeInBlock>

    <FadeInBlock client:visible delay={0.3}>
      <div class="insight-box">
        <p style={`font-family: var(--font-heading); font-size: 0.85rem; font-weight: 700; color: ${chapter.accent}; margin: 0 0 0.5rem;`}>The goal isn't to write every line — it's to understand every line.</p>
        <p style="font-size: 1rem; line-height: 1.75; margin: 0;">
          The best Claude Code users aren't the ones who generate the most code. They're the ones who ask the best questions and catch the subtlest bugs. Your knowledge is your quality filter.
        </p>
      </div>
    </FadeInBlock>
  </section>

  <!-- ═══ WIDGET: REFACTOR RACE ═══ -->
  <section class="max-w-[900px] mx-auto px-6 md:px-10 py-8">
    <FadeInBlock client:visible>
      <RefactorRace client:visible />
    </FadeInBlock>
  </section>

  <Divider accent={chapter.accent} client:load />

  <!-- ═══ KEY CONCEPTS ═══ -->
  <section class="max-w-[680px] mx-auto px-6 md:px-10 py-16">
    <FadeInBlock client:visible>
      <h2 class="mb-12" style="font-family: var(--font-heading);">Key Concepts</h2>
    </FadeInBlock>

    <div style="display: flex; flex-direction: column; gap: 1rem;">
      {chapter.concepts.map((concept, i) => (
        <FadeInBlock client:visible delay={i * 0.08}>
          <ConceptCard
            name={concept.name}
            description={concept.description}
            accent={chapter.accent}
            index={i}
            client:load
          />
        </FadeInBlock>
      ))}
    </div>
  </section>

  <Divider accent={chapter.accent} client:load />

  <!-- ═══ CLOSING ═══ -->
  <section class="max-w-[680px] mx-auto px-6 md:px-10 py-24">
    <FadeInBlock client:visible>
      <div class="pull-quote" style={`border-color: ${chapter.accent}; max-width: 50ch; margin: 0 auto 2rem;`}>
        The best coders in the AI era won't be the fastest typists. They'll be the clearest thinkers.
      </div>
    </FadeInBlock>

    <FadeInBlock client:visible delay={0.1}>
      <p class="text-lg leading-[1.85] text-center mx-auto" style="max-width: 55ch;">
        You've learned the tool. Next, we zoom out to the bigger picture — how to orchestrate AI across projects that are larger than any single conversation.
      </p>
    </FadeInBlock>
  </section>

</ChapterLayout>
